services:
  # Frontend Service
  - type: web
    name: recharge-frontend-c525
    runtime: static
    region: singapore
    plan: free
    buildCommand: cd Mobilerecharge && npm install && npm run build
    staticPublishPath: ./Mobilerecharge/dist
    pullRequestPreviewsEnabled: true
    headers:
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      # COOP header removed - it blocks Firebase signInWithPopup
      # Firebase needs popup communication which COOP blocks
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: NODE_ENV
        value: production
      # NOTE: Add these variables manually in Render Dashboard for security:
      # VITE_API_URL, VITE_FIREBASE_API_KEY, VITE_FIREBASE_AUTH_DOMAIN,
      # VITE_FIREBASE_PROJECT_ID, VITE_FIREBASE_STORAGE_BUCKET,
      # VITE_FIREBASE_MESSAGING_SENDER_ID, VITE_FIREBASE_APP_ID
        
  # Backend Service  
  - type: web
    name: mobilerechargeweb
    runtime: node
    region: singapore
    plan: free
    buildCommand: cd Mobilerecharge/backend && npm install
    startCommand: cd Mobilerecharge/backend && node src/server.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 5002
      - key: ALLOWED_ORIGINS
        value: http://localhost:3004,http://localhost:5173,https://recharge-frontend-c525.onrender.com
      # NOTE: Add these SECRET variables manually in Render Dashboard (NOT in YAML):
      # MONGODB_URI - Your MongoDB connection string
      # JWT_SECRET - Generate strong secret: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
      # FIREBASE_PROJECT_ID - Your Firebase project ID
